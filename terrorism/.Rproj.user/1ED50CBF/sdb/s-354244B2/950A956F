{
    "contents" : "# Andrew Flowers <andrew.flowers@fivethirtyeight.com>\n# Nov 13, 2015\n\nsetwd(\"~/private-data/terrorism/\") # Change according to one's directory structure\n\nrequire(readr)\nrequire(dplyr)\nrequire(ggplot2)\nrequire(reshape2)\n\n# Load raw data\nrawData <- data.frame()\n\nfor (f in list.files(\"./raw-data/\")){\n  data <- read_csv(paste0(getwd(), \"/raw-data/\", f))\n  rawData <- rbind(rawData, data)\n}\n\ndim(rawData)\nnames(rawData)\nstr(rawData)\n\n# Add in 1993 country statistics from Appendix II of the GTD codebook\nstats1993 <- read_csv(\"country_stats_1993_appendix2.csv\")\n\n##### France analysis #####\n\n# Look at incidents in France\nfrance <- rawData %>% filter(country_txt==\"France\")\ndim(france)\n\n# Incidents by year -- 1993 is missing from this data\ntable(france$iyear, useNA=\"ifany\")\nfrance %>% group_by(iyear) %>%\n  summarize(incidents=n()) %>%\n  arrange(desc(iyear))\n\n# Fatalities by yeaer\nfraFatByYear <- france %>% group_by(iyear) %>% \n  summarize(fatalities=sum(nkill, na.rm=T)) %>%\n  arrange(desc(fatalities))\n\n# Add in 1993 data -- 5 fatalities in France\nfraFatByYear <- rbind(fraFatByYear, \n                      data.frame(iyear=1993, \n                                 fatalities=stats1993[match(\"France\", stats1993$Country),]$`Number Killed`))\n\n# Analysis: France had 274 fatalities from terrorism incidents between 1972 and 2014.\nfraFatByYear\nsum(fraFatByYear$fatalities, na.rm=T)\n\nwrite_csv(fraFatByYear %>% arrange(desc(iyear)), \"france_terrorism_fatalities_by_year.csv\")\n\ng <- ggplot(data=fraFatByYear, aes(x=iyear, y=fatalities))+\n  geom_line() + xlab(\"Year\") + ylab(\"Fatalities\")+\n  ggtitle(\"Fatalities from terrorism, in France\")\ng\nggsave(filename=\"france_fatalities.png\", plot=g)\n\n##### EU-wide analysis #####\n\n# Founding since countries (pre-1973)\neuFounders <- c(\"Belgium\",\n                 \"France\",\n                 \"Italy\",\n                 \"Germany\",\n                 \"Netherlands\",\n                 \"Luxembourg\"\n                 )\n\n# Countries that joined the EU through 1986\neuCountries <- c(euFounders,\n                 \"Denmark\",\n                 \"Ireland\",\n                 \"United Kingdom\",\n                 \"Greece\",\n                 \"Portugal\",\n                 \"Spain\")\n# EU data\neuData <- rawData %>% filter(country_txt %in% euCountries)\n\n# Filter out data since 1986\neuData_since1986 <- euData %>% filter(iyear>=1986)\n\n# Tally EU-wide fatalities by year\neuFatalities <- euData_since1986 %>% group_by(iyear) %>% \n  summarize(fatalities=sum(nkill, na.rm=T)) %>%\n  arrange(desc(fatalities))\n\n# Calculate EU-wide fatalities in 1993 and add to data\neuFat_in1993 <- stats1993 %>% filter(Country %in% euCountries) %>% summarize(sum(`Number Killed`))\n\neuFatalities <- rbind(euFatalities, \n                      data.frame(iyear=1993, \n                                 fatalities=as.numeric(euFat_in1993)))\n\nwrite_csv(euFatalities %>% arrange(desc(iyear)), \"eu_terrorism_fatalities_by_year.csv\")\n\ng2 <- ggplot(data=euFatalities, aes(x=iyear, y=fatalities))+\n  geom_line() + xlab(\"Year\") + ylab(\"Fatalities\")+\n  ggtitle(\"Fatalities from terrorism, in EU countries since 1986 \\n Of members who joined in 1986 or before\")\ng2\nggsave(filename=\"eu_fatalities.png\", plot=g2)\n\n##### Country-by-country breakdown #####\neuData <- rawData %>% \n  filter(country_txt %in% euCountries) %>% \n  select(iyear, country_txt, nkill)\n\n# Tally 1993 data by country and add \neu1993data <- stats1993 %>% \n  filter(Country %in% euCountries) %>% \n  group_by(Country) %>% \n  summarize(nkill=sum(`Number Killed`)) %>% \n  mutate(iyear=1993) %>% \n  select(iyear, Country, nkill)\n\nnames(eu1993data)[2] <- 'country_txt'\n\neuData <- rbind(euData, eu1993data)\n\neuData_spread <- euData %>% \n  dcast(formula=iyear~country_txt, value.var=\"nkill\", fun.aggregate=sum, na.rm=T)\n\nwrite_csv(euData_spread, \"eu_terrorism_fatalities_by_country.csv\")\n\ng3 <- ggplot(data=euData, aes(x=iyear, y=nkill))+\n  geom_line() + xlab(\"Year\") + ylab(\"Fatalities\")+ facet_wrap(~country_txt)+\n  ggtitle(\"Fatalities from terrorism, in EU countries since 1986 \\n Of members who joined in 1986 or before\")\ng3\n\nggsave(filename=\"eu_fatalities_by_country.png\", plot=g3)\n\n# Calculations\n\n# France fatalities since from 1986 until now\nfraFatByYear %>% filter(iyear>1985) %>% summarize(sum(fatalities))\n\n# All EU fatalities (of those pre-1986 countries) from 1986 until now\neuFatalities %>% filter(iyear>1985) %>% summarize(sum(fatalities))\n\n# In the last decade:\neuFatalities %>% filter(iyear>2005) %>% summarize(sum(fatalities))",
    "created" : 1447522477783.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "434523496",
    "id" : "950A956F",
    "lastKnownWriteTime" : 1447536002,
    "path" : "~/private-data/terrorism/paris_terror_analysis.R",
    "project_path" : "paris_terror_analysis.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}